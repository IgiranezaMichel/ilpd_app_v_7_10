@(training: Training)

@main("Period",""){
    <div class="container" style="padding-top: 50px">
        <div class="row">
            <div class="col-md-12">
                <div class="section-heading">
                    <ol class="breadcrumb">
                        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
                        <li><a href="#">Students</a></li>
                        <li class="active">@training.tNames()</li>
                    </ol>
                </div>

                <div class="panel-content">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="box box-primary">
                                <div class="box-header with-border">
                                    <h3 class="box-title">Students</h3>

                                    <div class="box-tools pull-right">
                                        @*<button type="button" class="btn btn-flat btn-sm btn-primary" data-toggle="modal"
                                        data-target="#addModel">
                                        <i class="ion-android-add"></i> Add Customer
                                        </button>*@
                                        <button type="button" class="btn btn-box-tool" data-widget="collapse"><i
                                        class="fa fa-minus"></i>
                                        </button>
                                        <button type="button" class="btn btn-box-tool" data-widget="remove"><i
                                        class="fa fa-times"></i></button>
                                    </div>
                                </div>
                                    <!-- /.box-header -->
                                <div class="box-body">
                                        <!-- /.row -->
                                        <table class="table table-condensed table-striped" id="manageTable">
                                            <thead>
                                                <tr>
                                                    @*<th>Image</th>*@
                                                    <th>Name</th>
                                                    <th>Email</th>
                                                    <th>Phone</th>
                                                    <th>Address</th>
                                                    <th>Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                            </tbody>
                                        </table>
                                </div>
                                    <!-- /.box-body -->
                                <div class="box-footer no-padding">
                                </div>
                                    <!-- /.footer -->
                            </div>
                                <!-- /.box -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!--modal add-->
    <div class="modal fade" id="addModel" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">

                <form class="form-horizontal basic-form" id="submitForm" action="{{ route('customer.store') }}"
                method="POST" novalidate>
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title"><i class="fa fa-plus"></i> Add new customer </h4>
                    </div>
                    <div class="modal-body">

                        <div id="add-messages"></div>

                        <div class="form-group">
                            <label for="profile" class="col-sm-3 control-label"> Image</label>
                            <label class="col-sm-1 control-label">: </label>
                            <div class="col-sm-8">
                                <div class="fileinputs">
                                    <input type="file" class="file form-control"  id="profile" name="profile">
                                    <div class="fakefile">
                                        <span> Browse image to upload</span>
                                    </div>
                                </div>
                            </div>
                        </div> <!-- /form-group-->

                        <div class="form-group">
                            <label for="name" class="col-sm-3 control-label">Name</label>
                            <label class="col-sm-1 control-label">: </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="name" placeholder="Full name" name="name"
                                autocomplete="off" required>
                            </div>
                        </div> <!-- /form-group-->

                        <div class="form-group">
                            <label for="email" class="col-sm-3 control-label"> Email </label>
                            <label class="col-sm-1 control-label">: </label>
                            <div class="col-sm-8">
                                <input type="email" class="form-control" id="email" placeholder="Email address" name="email" autocomplete="off" required>
                            </div>
                        </div> <!-- /form-group-->

                        <div class="form-group">
                            <label for="phone" class="col-sm-3 control-label"> Phone </label>
                            <label class="col-sm-1 control-label">: </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="mileage" placeholder="Phone number"
                                name="phone" autocomplete="off" required>
                            </div>
                        </div> <!-- /form-group-->

                        <div class="form-group">
                            <label for="address" class="col-sm-3 control-label"> Address </label>
                            <label class="col-sm-1 control-label">: </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="address" placeholder="Address"
                                name="address" autocomplete="off" required>
                            </div>
                        </div> <!-- /form-group-->

                        <div class="form-group">
                            <label for="password" class="col-sm-3 control-label"> Password </label>
                            <label class="col-sm-1 control-label">: </label>
                            <div class="col-sm-8">
                                <input type="password" class="form-control" id="password" placeholder="Default password" name="password" autocomplete="off" required>
                            </div>
                        </div> <!-- /form-group-->

                        {{ csrf_field() }}

                    </div> <!-- /modal-body -->

                    <div class="modal-footer">
                        <button type="button" class="btn btn-default btn-flat" data-dismiss="modal">Close</button>

                        <button type="submit" class="btn btn-primary btn-flat" id="createBtn"
                        data-loading-text="Loading..." autocomplete="off"> Save Changes
                        </button>
                    </div>
                        <!-- /modal-footer -->
                </form>
                    <!-- /.form -->
            </div>
                <!-- /modal-content -->
        </div>
            <!-- /modal-dialog -->
    </div>
        <!-- / add modal -->

        <!-- edit  -->
    <div class="modal fade" id="editModel" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">

                <form class="form-horizontal" id="editForm" action="{{ route('customer.update')}}" method="POST">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title"><i class="glyphicon glyphicon-edit"></i> Edit </h4>
                    </div>
                    <div class="modal-body">

                        <div id="edit-messages"></div>

                        <div class="modal-loading div-hide"
                        style="width:50px; margin:auto;padding-top:50px; padding-bottom:50px;">
                            <i class="fa fa-spinner fa-pulse fa-3x fa-fw"></i>
                            <span class="sr-only">Loading...</span>
                        </div>

                        <div class="edit-result">

                            <div class="nav-tabs-custom">
                                <ul class="nav nav-tabs">
                                    <li class="active"><a href="#tab_1" data-toggle="tab"
                                    aria-expanded="false">Image</a></li>
                                    <li class="">
                                        <a href="#tab_2" data-toggle="tab" aria-expanded="false">Customer info</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" id="tab_1">
                                        <div class="form-group">
                                            <label for="edit-image" class="col-sm-3 control-label">Image</label>
                                            <label class="col-sm-1 control-label">: </label>
                                            <div class="col-sm-8">
                                                <img src="" id="edit-image"
                                                class="thumbnail center-block img-responsive"
                                                style="max-height:250px;overflow-x: hidden"/>
                                            </div>
                                        </div> <!-- /form-group-->
                                        <div class="form-group">
                                            <label for="edit-profile" class="col-sm-3 control-label"> Image</label>
                                            <label class="col-sm-1 control-label">: </label>
                                            <div class="col-sm-8">
                                                <div class="fileinputs">
                                                    <input type="file" class="file form-control" id="edit-profile" name="profile">
                                                    <div class="fakefile">
                                                        <span> Browse image to upload</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div> <!-- /form-group-->
                                    </div>
                                        <!-- /.tab-pane -->
                                    <div class="tab-pane" id="tab_2">
                                        <div class="form-group">
                                            <label for="edit-name" class="col-sm-3 control-label">Name</label>
                                            <label class="col-sm-1 control-label">: </label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="edit-name" placeholder="Full name" name="name" autocomplete="off" required>
                                            </div>
                                        </div> <!-- /form-group-->

                                        <div class="form-group">
                                            <label for="edit-email" class="col-sm-3 control-label"> Email </label>
                                            <label class="col-sm-1 control-label">: </label>
                                            <div class="col-sm-8">
                                                <input type="email" class="form-control" id="edit-email" placeholder="Email address" name="email" autocomplete="off" required>
                                            </div>
                                        </div> <!-- /form-group-->

                                        <div class="form-group">
                                            <label for="edit-phone" class="col-sm-3 control-label"> Phone </label>
                                            <label class="col-sm-1 control-label">: </label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="edit-phone" placeholder="Phone number"
                                                name="phone" autocomplete="off" required>
                                            </div>
                                        </div> <!-- /form-group-->

                                        <div class="form-group">
                                            <label for="edit-address" class="col-sm-3 control-label"> Address </label>
                                            <label class="col-sm-1 control-label">: </label>
                                            <div class="col-sm-8">
                                                <input type="text" class="form-control" id="edit-address" placeholder="Address"
                                                name="address" autocomplete="off" required>
                                            </div>
                                        </div> <!-- /form-group-->

                                        <div class="form-group">
                                            <label for="edit-password" class="col-sm-3 control-label"> Password </label>
                                            <label class="col-sm-1 control-label">: </label>
                                            <div class="col-sm-8">
                                                <input type="password" class="form-control" id="edit-password" placeholder="Default password" name="password" autocomplete="off" required>
                                            </div>
                                        </div> <!-- /form-group-->

                                        {{ csrf_field() }}
                                    </div>
                                        <!-- /.tab-pane -->
                                </div>
                                    <!-- /.tab-content -->
                            </div>
                        </div>
                            <!-- /edit  result -->

                    </div> <!-- /modal-body -->

                    <div class="modal-footer editFooter">
                        <button type="button" class="btn btn-default" data-dismiss="modal"><i
                        class="glyphicon glyphicon-remove-sign"></i> Close
                        </button>

                        <button type="submit" class="btn btn-success" id="editBtn"
                        data-loading-text="Loading...">
                            <i class="glyphicon glyphicon-ok-sign"></i>
                            Save Changes
                        </button>
                    </div>
                        <!-- /modal-footer -->
                </form>
                    <!-- /.form -->
            </div>
                <!-- /modal-content -->
        </div>
            <!-- /modal-dailog -->
    </div>

        <!-- /edit  -->



}

<script>
        var defaultUrl='@routes.StudentController.studentByTraining(training.id)';
        var manageTable = $("#manageTable");
        var table = null;
        $('#customer').addClass('active');
        function myFunc() {
            table = manageTable.DataTable({
                ajax: {
                    url: defaultUrl,
                    dataSrc: ''
        },
            columns: [
                {data: 'firstName'},
                {data: 'familyName'},
                {data: 'regNo'},
                {data: 'address'},
                {
                    data: 'id',
                    render: function (data, type, row) {
                        return "<button class='btn btn-link js-edit' data-url='/admin/customer/show/" + row.id + "' data-id='" + row.id + "'> " +
                                "<i class='ion-compose'></i></button>" +
                                "<button class='btn btn-link js-delete text-red' data-id='" + data +
                                "' data-url='/admin/customer/delete/" + row.id + "'> <i class='ion-android-delete'></i></button>";
                    }
                }
            ]
        });
        }
        $(document).ready(function () {
            //initialize data table
            myFunc();
            //Delete
            manageTable.on('click', '.js-delete', function () {
                var button = $(this);
                bootbox.confirm("Are you sure you want to delete this record?", function (result) {
                    if (result) {
                        $.ajax({
                            url: button.attr('data-url'),
                            method: 'DELETE',
                            data: {_token: $('#token').val()},
                            success: function () {
                                var tr = button.parents("tr");
                                table.rows(tr).remove().draw(false);
                            }, error: function () {
                                bootbox.alert({
                                    title: "Error",
                                    message: "<i class='fa fa-warning'></i> Record not deleted please try again"
                                });
                            }
                        });

                    }
                })
            });

            //Edit and update
            manageTable.on('click', '.js-edit', function () {
                $('#editModel').modal('show');
                var url = $(this).attr('data-url');
                var id = $(this).attr('data-id');
                console.log(url);
                $.ajax({
                    url: url,
                    type: 'get',
                    data: {id: id},
                    dataType: 'json',
                    success: function (response) {
                        console.log(response);
                        // modal loading
                        $('.modal-loading').addClass('div-hide');
                        // modal result
                        $('.edit-result').removeClass('div-hide');
                        // modal footer
                        var footer = $('.editFooter');
                        footer.removeClass('div-hide');

                        // setting values returned
                        $("#edit-name").val(response.name);
                        $("#edit-email").val(response.email);
                        $("#edit-phone").val(response.phone);
                        $("#edit-address").val(response.address);
                        $("#edit-password").val(response.password);
                        $("#edit-image").attr('src', '/photos/customers/' + response.profile);

                        // add hidden id
                        footer.after('<input type="hidden" name="id" id="id" value="' + response.id + '" />');
                        // update - form
                        $('#editForm').unbind('submit').bind('submit', function (e) {
                            e.preventDefault();
                            var form = $(this);
                            var formData = new FormData(this);
                            form.parsley().validate();
                            if (!form.parsley().isValid()) {
                                return false;
                            }

                            // edit btn
                            $('#editBtn').button('loading');

                            $.ajax({
                                url: form.attr('action'),
                                type: form.attr('method'),
                                data: formData,
                                dataType: 'json',
                                cache: false,
                                contentType: false,
                                processData: false
                            }).done(function (response) {
                                console.log(response);
                                // submit btn
                                $('#editBtn').button('reset');
                                form[0].reset();
                                // reload the table
                                table.destroy();
                                myFunc();
                                // remove the error text
                                $(".text-danger").remove();
                                // remove the form error
                                $('#edit-messages').html('<div class="alert alert-success">' +
                                        '<button type="button" class="close" data-dismiss="alert">&times;</button>' +
                                        '<strong><i class="glyphicon glyphicon-ok-sign"></i></strong> User successfully updated. </div>');

                                $(".alert-success").delay(500).show(10, function () {
                                    $(this).delay(3000).hide(10, function () {
                                        $(this).remove();
                                    });
                                }); // /.alert
                            }).fail(function (response) {
                                console.log(response);
                                $('#editBtn').button('reset');
                                alert("Try again later");
                            });	 // /ajax

                            return false;
                        }); // /update - form

                    } // /success
                }); // ajax function
            });
        });
</script>
<script type="text/javascript">
        $(function () {
            var submitForm = $('#submitForm');
            submitForm.parsley();
            //add new
            submitForm.submit(function (e) {
                // e.preventDefault();
                var form = $(this);
                var formData = new FormData(this);
                form.parsley().validate();
                if (!form.parsley().isValid()) {
                    return false;
                }
                // button loading
                $("#createBtn").button('loading');
                $.ajax({
                    url: form.attr('action'),
                    method: form.attr('method'),
                    data: formData,
                    dataType: 'json',
                    cache: false,
                    contentType: false,
                    processData: false
                }).done(function (response) {
                    // button loading
                    $("#createBtn").button('reset');
                    form[0].reset();
                    table.destroy();
                    myFunc();
                    // reload the manage member table
                    $('#add-messages').html('<div class="alert alert-success">' +
                            '<button type="button" class="close" data-dismiss="alert">&times;</button><strong><i class="glyphicon glyphicon-ok-sign"></i> Car successfully added.</strong></div>');

                    $(".alert-success").delay(500).show(100, function () {
                        $(this).delay(3000).hide(50, function () {
                            $(this).remove();
                        });
                    }); // /.alert
                }).fail(function (response) {
                    console.log(response);
                    // button loading
                    $("#createBtn").button('reset');

                    var errorsHtml = '<div class="alert alert-danger">' + '<button type="button" class="close" data-dismiss="alert">&times;</button><strong><i class="fa fa-warning"></i> ';

                    errorsHtml += 'Below are all errors found please correct them and try again.</strong>';
                    errorsHtml += '<ul>';
                    var messages = $('#add-messages');
                    if (response.status === 422) {
                        //process validation errors here.
                        $errors = response.responseJSON; //this will get the errors response data.
                        //show them somewhere in the markup
                        $.each($errors.errors, function (key, value) {
                            errorsHtml += '<li>' + value + '</li>'; //showing only the first error.
                        });

                        messages.html(errorsHtml); //appending to a <div id="form-errors"></div> inside form
                    } else {
                        errorsHtml += '<li>' + 'Unknown errors please try again' + '</li>';
                    }

                    errorsHtml += '</ul>';
                    errorsHtml += '</p></div>';
                    messages.html(errorsHtml);

                    $(".alert-danger").delay(500).show(100, function () {
                        $(this).delay(10000).hide(50, function () {
                            $(this).remove();
                        });
                    }); // /.alert
                });
                return false;
            });
        });
        //edit button
</script>